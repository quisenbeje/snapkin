# snapkin

This script helps to manage files and directories which have been backed-up in
btrfs snapshots. Given a file or directory the script will search for snapshots
which contain the target, and, based on commands and options, the scrip will list,
show disk usage, and/or delete the targets in the snapshots. Executing the script
requires root access to perform btrfs commands.

If removing files, the script will change targeted snapshots to non-readonly, if
they are readonly; delete the file/directory; and if snapshot was readonly, return
the shapshot to readonly. The delete is recursive, forced, and occurs with elevated
privileges. There are a few fail safes in place, still **proceed with caution**

## example usage
Script with no options or argurments will show the snapshots containing the
current working directory. This is command is safe.
```bash
$ sudo snapkin
```
This is equivalent to,
```bash
$ sudo snapkin list `pwd`
```
### list
The list command shows all snapshots which contain the specified target path (file
or directory) and information about each snapshot, such as date created, flags,
and disk usage (as seen by `du -h -d0 PATH`).
```bash
$ sudo snapkin list -fd PATH
```
### remove
The remove command collects all of the snapshot information generated by the
list command and given the options, deletes the PATH in all snapshots or shows a
preview of the deletions without executing the deletion.
```bash
$ sudo snapkin remove PATH
```
Prior to removing the file or directory one prompt will show the number of
deletions and one last continue option. A 'y', 'Y', or <enter> will initiate
deletion, **be cautious**. There is also an interactive flag, -i, which will
prompt the deletion the file or directory for each snapshot using the full path;
this is safer, but is likely to involve many prompts. Note, the prompt will give
a 'Y\n\q' option, which is yes, no, and quit, with yes being the default. Quit
will exit the command at that point, but all previous deletions, yeses, will
have occurred.

The -p option will do the same only it will list out the full path which would
have been deleted had no -p flag been present. This preview version of the
remove command is safe, and **suggested** prior to actually initiating deletion.
```bash
$ sudo snapkin remove -p PATH
```
All deletions to this point have been directed at snapshots, which means the
target (file or directory) still exists on the active filesystem, and as a
result will not free up any disk space, and will continue to be backed up on
subsequent snapshots. The remove command with the -a flag will remove all
snapshots of the target as well as the target on the active filesystem.
```bash
$ sudo snapkin remove -a PATH
```
